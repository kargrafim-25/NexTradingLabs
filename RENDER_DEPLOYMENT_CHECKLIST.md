# Render Deployment Checklist

## ‚úÖ Pre-Deployment Requirements

### 1. **Render Account Setup**
- [ ] Create a Render account at https://render.com
- [ ] Have your PostgreSQL database already created on Render
- [ ] Copy your database connection string (Internal or External)

### 2. **Required Environment Variables**

You'll need to set these environment variables in your Render dashboard:

| Variable | Description | Example | Required |
|----------|-------------|---------|----------|
| `DATABASE_URL` | PostgreSQL connection string from your Render database | `postgresql://user:pass@host/db` | ‚úÖ Yes |
| `SESSION_SECRET` | Auto-generated by Render | (auto-generated) | ‚úÖ Yes |
| `OPENAI_API_KEY` | OpenAI API key for trading signal generation | `sk-...` | ‚úÖ Yes |
| `BREVO_API_KEY` | Brevo API key for email/SMS verification | `xkeysib-...` | ‚úÖ Yes |
| `ADMIN_EMAIL` | Admin account email | `admin@yourdomain.com` | ‚úÖ Yes |
| `ADMIN_PASSWORD` | Admin account password | Strong password | ‚úÖ Yes |
| `FRONTEND_URL` | Your Render app URL | `https://your-app.onrender.com` | ‚úÖ Yes |
| `ALPHA_VANTAGE_API_KEY` | Alpha Vantage API (optional backup) | (optional) | ‚ö™ No |

### 3. **Database Setup**

Your existing Render PostgreSQL database will be used. The app will automatically:
- Create all necessary tables on first deployment (via `db:push` in postinstall)
- Create a `sessions` table for user sessions
- Initialize with sample data in development mode

**Important:** Make sure your DATABASE_URL has SSL enabled (Render databases require it).

---

## üöÄ Deployment Steps

### Option 1: Deploy via Render Dashboard (Recommended)

1. **Connect Repository**
   - Go to Render Dashboard
   - Click "New +" ‚Üí "Web Service"
   - Connect your GitHub repository

2. **Configure Service**
   - **Name:** `ntl-trading-platform` (or your preferred name)
   - **Environment:** `Node`
   - **Build Command:** `npm install && npm run build`
   - **Start Command:** `npm start`
   - **Plan:** Choose your plan (Starter or higher recommended)

3. **Set Environment Variables**
   - In the service settings, add all required environment variables listed above
   - **DATABASE_URL:** Paste your Render PostgreSQL connection string
   - **FRONTEND_URL:** Will be `https://[your-service-name].onrender.com`
   - Add all other required variables

4. **Deploy**
   - Click "Create Web Service"
   - Render will automatically deploy your app

### Option 2: Deploy via render.yaml Blueprint

1. **Update render.yaml** (already done)
   - The file is configured to work with your existing database

2. **Deploy via Dashboard**
   - Go to Render Dashboard
   - Click "New +" ‚Üí "Blueprint"
   - Connect your repository
   - Render will read `render.yaml` and set up the service

3. **Configure Missing Variables**
   - After deployment, go to Environment tab
   - Add the environment variables that are marked `sync: false`

---

## üîç Post-Deployment Verification

### 1. **Check Health Endpoint**
Visit: `https://your-app.onrender.com/health`

Expected response:
```json
{
  "status": "ok",
  "timestamp": "2025-10-18T...",
  "service": "ntl-trading-platform",
  "environment": "production"
}
```

### 2. **Test Admin Login**
1. Go to `https://your-app.onrender.com/login`
2. Login with your ADMIN_EMAIL and ADMIN_PASSWORD
3. You should be redirected to the dashboard

### 3. **Check Database Tables**
The following tables should be automatically created:
- `users`
- `trading_signals`
- `economic_news`
- `security_events`
- `password_reset_tokens`
- `verification_tokens`
- `payment_requests`
- `sessions`

### 4. **Test Key Features**
- [ ] User registration works
- [ ] Email verification works (check Brevo logs)
- [ ] Plan selection works
- [ ] Payment flow redirects to WhatsApp
- [ ] Signal generation works (requires OpenAI API)
- [ ] Admin dashboard is accessible

---

## ‚ö†Ô∏è Common Issues & Solutions

### Issue 1: "DATABASE_URL must be set" Error
**Solution:** Make sure DATABASE_URL is set in environment variables with your Render PostgreSQL connection string.

### Issue 2: Session not persisting / Users logged out on restart
**Solution:** This is now fixed! The app uses PostgreSQL session store in production. Make sure DATABASE_URL is set.

### Issue 3: Build fails with "dist not found"
**Solution:** This is expected during the first deployment. The build command creates the dist folder. Make sure `npm run build` is in your build command.

### Issue 4: CORS errors in production
**Solution:** Make sure FRONTEND_URL environment variable matches your actual Render URL (e.g., `https://your-app.onrender.com`).

### Issue 5: Email verification not working
**Solution:** 
- Check that BREVO_API_KEY is set correctly
- Verify the API key is active in your Brevo dashboard
- Check Brevo logs for delivery status

### Issue 6: Signal generation fails
**Solution:**
- Verify OPENAI_API_KEY is set correctly
- Check OpenAI account has sufficient credits
- Review server logs for specific error messages

---

## üìä Monitoring

### View Logs
- Go to your Render service dashboard
- Click on "Logs" tab
- Monitor for errors during and after deployment

### Database Monitoring
- Go to your Render PostgreSQL dashboard
- Check connection count and database size
- Monitor query performance

---

## üîß Production Configuration Summary

### Changes Made for Render Deployment:

1. ‚úÖ **Session Store:** PostgreSQL-backed sessions for production (prevents logout on restart)
2. ‚úÖ **Database Configuration:** SSL enabled for Render PostgreSQL compatibility
3. ‚úÖ **Environment Variables:** All required variables documented
4. ‚úÖ **Build Process:** Optimized build and start commands
5. ‚úÖ **Health Check:** `/health` endpoint for Render monitoring
6. ‚úÖ **Static File Serving:** Production build served from `dist/public`
7. ‚úÖ **CORS:** Configured for production domain
8. ‚úÖ **Security:** Helmet security headers enabled
9. ‚úÖ **Proxy Trust:** Configured for Render's proxy

### Optional Configurations:

- Replit Auth is **disabled** by default (requires REPLIT_DOMAINS env var)
- Alpha Vantage API is optional (has fallback data)

---

## üìù Next Steps After Deployment

1. **Update Domain (Optional)**
   - Configure custom domain in Render dashboard
   - Update FRONTEND_URL environment variable

2. **Monitor Performance**
   - Check response times
   - Monitor database query performance
   - Review server logs for errors

3. **Set Up Alerts**
   - Configure Render alerts for downtime
   - Set up notifications for errors

4. **Backup Strategy**
   - Render PostgreSQL includes automated backups
   - Review backup frequency in database settings

---

## üéâ You're Ready!

Your NTL Trading Platform is now production-ready for Render deployment!

If you encounter any issues during deployment, check:
1. Render service logs
2. Database connection status
3. Environment variables are all set correctly
4. External API keys (OpenAI, Brevo) are valid

Good luck with your deployment! üöÄ
